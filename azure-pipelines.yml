trigger:
- master

pool:
  name: Default
  demands:
  - agent.name -equals test-deneme

variables:
  ANDROID_HOME: 'C:\agent\Android\Sdk'
  FASTLANE_PLUGIN_PATH: $(System.DefaultWorkingDirectory)/fastlane

steps:
- script: |
    echo Starting Gradle Build
    ./gradlew assembleDebug 
  displayName: 'Run Gradle Build'
  env:
    ANDROID_HOME: $(ANDROID_HOME)

- script: |
    ./gradlew sonar -Dsonar.projectKey=FitAI-Android -Dsonar.projectName='FitAI-AndroidFitAI-Android' -Dsonar.host.url=http://localhost:9000 -Dsonar.login=sqp_ce94ce25d0ae5f17a06e639a8186627833aefdde
  displayName: 'Run SonarQube Analysis'
  env:
    ANDROID_HOME: $(ANDROID_HOME)
    
- script: |
    set PATH=%PATH%;C:\Ruby32-x64\bin\
    set FASTLANE_OPT_OUT_INTERACTIVE=false
    gem install fastlane-plugin-firebase_app_distribution
    fastlane android beta
  displayName: 'Beta Dağıtımı'
  env:
    ANDROID_HOME: $(ANDROID_HOME)
    FASTLANE_PLUGIN_PATH: $(FASTLANE_PLUGIN_PATH)